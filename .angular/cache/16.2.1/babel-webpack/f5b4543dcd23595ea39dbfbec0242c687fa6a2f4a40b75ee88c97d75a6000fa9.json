{"ast":null,"code":"import _asyncToGenerator from \"D:/r/class record/TDH APP/cyber-mobile/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { environment } from 'src/environments/environment';\nimport { Role } from '../model/token-model';\nimport { catchError, lastValueFrom, tap } from 'rxjs';\nimport { Chatchable } from './catche-service.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@ionic/angular\";\nlet AuthService = /*#__PURE__*/(() => {\n  var _class;\n  class AuthService extends Chatchable {\n    static get isTeacher() {\n      return AuthService.user.role == Role.TEACHER;\n    }\n    static get isloged() {\n      return AuthService.tokenData?.token?.access_token && AuthService.tokenData?.token?.access_token.trim().length > 0 ? true : false;\n    }\n    static get token() {\n      return AuthService.tokenData?.token?.access_token ?? \"\";\n    }\n    static get user() {\n      return AuthService.tokenData?.user ?? {\n        name: \"\",\n        email: \"\"\n      };\n      ;\n    }\n    static get tokenData() {\n      var tokenDataString = localStorage.getItem(AuthService.key);\n      if (!tokenDataString) return undefined;\n      var tokenData = tokenDataString && JSON.parse(tokenDataString);\n      if (typeof tokenData != 'string') return tokenData;\n      return undefined;\n    }\n    constructor(http, router) {\n      super(http);\n      this.http = http;\n      this.router = router;\n      if (AuthService.token) this.getMe();\n    }\n    login(login) {\n      var _this = this;\n      return lastValueFrom(this.http.post(environment.api + '/user/login', login).pipe(tap( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (res) {\n          localStorage.setItem(AuthService.key, JSON.stringify(res));\n          yield _this.getMe();\n        });\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }())));\n    }\n    register() {}\n    changePassword(payload) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const url = `${environment.api}/update-password`;\n        return yield lastValueFrom(_this2.http.post(url, payload));\n      })();\n    }\n    changeProfile(file) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        const url = `${environment.api}/profile-image`;\n        return yield lastValueFrom(_this3.http.post(url, file));\n      })();\n    }\n    addedStudentFile(file, courseId) {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        const formData = new FormData();\n        formData.set('file', file);\n        const url = `${environment.api}/course/send-homework/${courseId}`;\n        return yield lastValueFrom(_this4.http.post(url, formData));\n      })();\n    }\n    classAttendance(courseId, attendant_date) {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        const url = `${environment.api}/course/apply-attendant`;\n        return yield lastValueFrom(_this5.http.post(url, {\n          courseId,\n          attendant_date\n        }));\n      })();\n    }\n    getMe() {\n      var _this6 = this;\n      return _asyncToGenerator(function* () {\n        const url = `${environment.api}/user-info`;\n        return yield lastValueFrom(_this6.http.get(url).pipe(tap( /*#__PURE__*/function () {\n          var _ref2 = _asyncToGenerator(function* (res) {\n            if (AuthService.tokenData) {\n              AuthService.tokenData.user = res;\n              localStorage.setItem(AuthService.key, JSON.stringify({\n                ...AuthService.tokenData,\n                user: res\n              }));\n            }\n          });\n          return function (_x2) {\n            return _ref2.apply(this, arguments);\n          };\n        }()), catchError(err => {\n          localStorage.removeItem(AuthService.key);\n          _this6.router.navigateForward(\"/auth/login\");\n          return err;\n        })));\n      })();\n    }\n    getContactInfo() {\n      var _this7 = this;\n      return _asyncToGenerator(function* () {\n        let path = `${environment.api}/settings`;\n        return yield _this7.get(\"settings\", path);\n      })();\n    }\n  }\n  _class = AuthService;\n  _class.key = \"auth\";\n  _class.ɵfac = function AuthService_Factory(t) {\n    return new (t || _class)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.NavController));\n  };\n  _class.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: _class,\n    factory: _class.ɵfac,\n    providedIn: 'root'\n  });\n  return AuthService;\n})();\nexport { AuthService };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}