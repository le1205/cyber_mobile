{"ast":null,"code":"import _asyncToGenerator from \"D:/r/class record/TDH APP/cyber-mobile/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { FormControl, Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/angular\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"src/app/services/chat.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"../../../../shared/components/slide-header/slide-header.component\";\nimport * as i7 from \"../../../../shared/directive/image-fall-back.directive\";\nconst _c0 = [\"content\"];\nfunction ChatingComponent_div_12_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"div\")(2, \"ion-avatar\");\n    i0.ɵɵelement(3, \"img\", 19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"div\")(5, \"div\", 20)(6, \"div\", 21);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"p\", 22);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const item_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵpropertyInterpolate(\"src\", item_r3.sender.picture, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", item_r3.sender.fullName, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", item_r3.message, \" \");\n  }\n}\nfunction ChatingComponent_div_12_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 23)(1, \"div\")(2, \"div\", 20)(3, \"div\", 21);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\", 22);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(7, \"div\")(8, \"ion-avatar\");\n    i0.ɵɵelement(9, \"img\", 24);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const item_r3 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", item_r3.sender.fullName, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", item_r3.message, \" \");\n    i0.ɵɵadvance(3);\n    i0.ɵɵpropertyInterpolate(\"src\", item_r3.sender.picture, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction ChatingComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵtemplate(1, ChatingComponent_div_12_div_1_Template, 10, 3, \"div\", 16);\n    i0.ɵɵtemplate(2, ChatingComponent_div_12_div_2_Template, 10, 3, \"div\", 17);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const item_r3 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !item_r3.isOur);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", item_r3.isOur);\n  }\n}\nlet ChatingComponent = /*#__PURE__*/(() => {\n  var _class;\n  class ChatingComponent {\n    constructor(navCtrl, ac, chatService) {\n      this.navCtrl = navCtrl;\n      this.ac = ac;\n      this.chatService = chatService;\n      this.messageFormControll = new FormControl('', [Validators.required, Validators.minLength(1)]);\n      this.id = -1;\n    }\n    ionViewDidEnter() {\n      this.getMessages();\n    }\n    ionViewDidLeave() {\n      if (this.timer) {\n        clearInterval(this.timer);\n      }\n    }\n    back() {\n      this.navCtrl.navigateBack('/home/chats');\n    }\n    getMessages() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const idParam = _this.ac.snapshot.paramMap.get(\"id\");\n        _this.id = idParam ? +idParam : -1;\n        if (!_this.id) return;\n        _this.chat = yield _this.chatService.getChat(+_this.id);\n        _this.messages = yield _this.chatService.getMessages(+_this.id);\n        _this.initTimer();\n        setTimeout(() => {\n          _this.content.scrollToBottom(0);\n        }, 50);\n      })();\n    }\n    sentMassage() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        if (_this2.messageFormControll.valid && _this2.id) {\n          try {\n            if (_this2.messageFormControll.value?.trim().length > 0) {\n              yield _this2.chatService.sendMessage(+_this2.id, _this2.messageFormControll.value);\n              _this2.initTimer();\n              _this2.messageFormControll.reset();\n            }\n          } catch (error) {}\n        }\n      })();\n    }\n    initTimer() {\n      var _this3 = this;\n      if (this.timer) {\n        clearInterval(this.timer);\n      }\n      this.timer = setInterval( /*#__PURE__*/_asyncToGenerator(function* () {\n        if (!_this3.messages) _this3.messages = [];\n        try {\n          const lastIndex = _this3.messages?.length;\n          if (lastIndex > 0) {\n            const created = _this3.messages[lastIndex - 1].created;\n            const newMessages = yield _this3.chatService.getNewMessages(_this3.id, created);\n            _this3.messages = [..._this3.messages, ...newMessages];\n            if (newMessages.length > 0) {\n              _this3.content.scrollToBottom(500);\n            }\n          } else {\n            if (!_this3.id) return;\n            _this3.messages = yield _this3.chatService.getMessages(+_this3.id);\n          }\n        } catch (error) {}\n      }), 1000);\n    }\n  }\n  _class = ChatingComponent;\n  _class.ɵfac = function ChatingComponent_Factory(t) {\n    return new (t || _class)(i0.ɵɵdirectiveInject(i1.NavController), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i3.ChatService));\n  };\n  _class.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _class,\n    selectors: [[\"chating\"]],\n    viewQuery: function ChatingComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.content = _t.first);\n      }\n    },\n    decls: 18,\n    vars: 6,\n    consts: [[1, \"-mt-1\", \"animate__bounceInDown\", \"animate__animated\"], [1, \"mb-3\"], [1, \"content-bg\", \"px-4\", \"mb-3\", \"flex\", \"justify-between\", \"items-center\", \"pb-2\"], [\"color\", \"light\", \"size\", \"large\", \"name\", \"chevron-back\", 1, \"w-12\", \"mr-3\", \"mt-5\", 3, \"click\"], [1, \"flex-auto\"], [1, \"pt-5\", \"text-lg\", \"text-[var(--color)]\"], [1, \"animate__bounceInUp\", \"animate__animated\", 3, \"fullscreen\", \"scrollX\"], [\"content\", \"\"], [1, \"flex\", \"flex-col\", \"items-center\", \"justify-center\", \"w-100\", \"pb-10\"], [1, \"flex\", \"flex-col\", \"flex-grow\", \"w-full\", \"rounded-l-lg\", \"rounded-br-lg\"], [\"class\", \"flex flex-col flex-grow px-2\", 4, \"ngFor\", \"ngForOf\"], [1, \"bg-[var(--ion-background)]\", \"backdrop-blur-md\", \"p-4\", \"flex\", \"justify-between\", \"items-center\", \"h-14\"], [\"type\", \"text\", \"placeholder\", \"Type your message\\u2026\", 1, \"flex\", \"msg-inp\", \"focus:!outline-none\", \"focus-within:!outline-none\", \"items-center\", \"h-10\", \"w-full\", \"rounded-full\", \"px-3\", \"text-sm\", \"text-[var(--ion-color)]\", \"bg-[var(--ion-background)]\", \"backdrop-blur-md\", 3, \"multiple\", \"formControl\", \"keyup.enter\"], [\"messageInput\", \"\"], [\"size\", \"large\", \"color\", \"primary\", \"name\", \"send\", 1, \"ml-3\", \"-rotate-45\", 3, \"click\"], [1, \"flex\", \"flex-col\", \"flex-grow\", \"px-2\"], [\"class\", \"flex w-full mt-4 space-x-3 max-w-xs -mr-6 ml-4\", 4, \"ngIf\"], [\"class\", \"flex w-full mt-4 space-x-3 max-w-xs ml-auto justify-end\", 4, \"ngIf\"], [1, \"flex\", \"w-full\", \"mt-4\", \"space-x-3\", \"max-w-xs\", \"-mr-6\", \"ml-4\"], [\"ImageFallBack\", \"\", \"alt\", \"\", \"srcset\", \"\", 1, \"w-11\", \"h-11\", \"object-cover\", \"mt-1\", 3, \"src\"], [1, \"bg-[var(--ion-background)]\", \"p-3\", \"rounded-l-lg\", \"rounded-br-lg\"], [1, \"w-full\", \"text-sm\", \"text-[var(--ion-color-primary)]\"], [1, \"text-xs\", \"break-all\"], [1, \"flex\", \"w-full\", \"mt-4\", \"space-x-3\", \"max-w-xs\", \"ml-auto\", \"justify-end\"], [\"ImageFallBack\", \"\", \"alt\", \"\", \"srcset\", \"\", 1, \"w-11\", \"h-11\", \"object-cover\", 3, \"src\"]],\n    template: function ChatingComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        const _r8 = i0.ɵɵgetCurrentView();\n        i0.ɵɵelementStart(0, \"slide-header\", 0)(1, \"ion-tolbar\", 1)(2, \"div\", 2)(3, \"ion-icon\", 3);\n        i0.ɵɵlistener(\"click\", function ChatingComponent_Template_ion_icon_click_3_listener() {\n          return ctx.back();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 4)(5, \"p\", 5);\n        i0.ɵɵtext(6);\n        i0.ɵɵelementEnd()()()()();\n        i0.ɵɵelementStart(7, \"ion-content\", 6, 7)(9, \"div\")(10, \"div\", 8)(11, \"div\", 9);\n        i0.ɵɵtemplate(12, ChatingComponent_div_12_Template, 3, 2, \"div\", 10);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(13, \"ion-footer\")(14, \"div\", 11)(15, \"input\", 12, 13);\n        i0.ɵɵlistener(\"keyup.enter\", function ChatingComponent_Template_input_keyup_enter_15_listener() {\n          return ctx.sentMassage();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"ion-icon\", 14);\n        i0.ɵɵlistener(\"click\", function ChatingComponent_Template_ion_icon_click_17_listener() {\n          i0.ɵɵrestoreView(_r8);\n          const _r2 = i0.ɵɵreference(16);\n          _r2.focus();\n          return i0.ɵɵresetView(ctx.sentMassage());\n        });\n        i0.ɵɵelementEnd()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(6);\n        i0.ɵɵtextInterpolate1(\" \", ctx.chat == null ? null : ctx.chat.title, \" \");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"fullscreen\", false)(\"scrollX\", false);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngForOf\", ctx.messages);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"multiple\", true)(\"formControl\", ctx.messageFormControll);\n      }\n    },\n    dependencies: [i4.NgForOf, i4.NgIf, i1.IonAvatar, i1.IonContent, i1.IonFooter, i1.IonIcon, i5.DefaultValueAccessor, i5.NgControlStatus, i5.FormControlDirective, i6.SlideHeaderComponent, i7.ImageFallBackDirective],\n    styles: [\".msg-inp[_ngcontent-%COMP%]:hover{outline:none}\"]\n  });\n  return ChatingComponent;\n})();\nexport { ChatingComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}